<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voting Page</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f4f4f4;
        }
        #teamOne, #teamTwo {
            margin: 20px;
            padding: 20px;
            border-radius: 10px;
            cursor: pointer;
        }
        #teamOne {
            background-color: #d32f2f;
            color: white;
        }
        #teamTwo {
            background-color: #1976d2;
            color: white;
        }
        #questionInfo {
            margin-top: 20px;
            font-size: 18px;
        }
    </style>
</head>
<body>

    <h1>Vote for Your Team!</h1>
    <div id="questionInfo">
        <p>Question Category: <span id="questionCategory"></span></p>
        <p>Question Points: <span id="questionPoints"></span></p>
    </div>
    <div id="teamOne" onclick="vote('TeamOne')">
        <h2 id="teamOneName">Team One</h2>
    </div>
    <div id="teamTwo" onclick="vote('TeamTwo')">
        <h2 id="teamTwoName">Team Two</h2>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCalPSOGndsWNRXCS2MWFZ_vaeSXEQVqlE",
            authDomain: "triviakw-dfe7f.firebaseapp.com",
            databaseURL: "https://triviakw-dfe7f-default-rtdb.firebaseio.com",
            projectId: "triviakw-dfe7f",
            storageBucket: "triviakw-dfe7f.appspot.com",
            messagingSenderId: "274369788646",
            appId: "1:274369788646:web:76b8cae5bcf9d404fd1927"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const urlParams = new URLSearchParams(window.location.search);
        const gameId = urlParams.get('gameId');
        const questionPoints = urlParams.get('points');
        const questionCategory = urlParams.get('category');

        document.getElementById('questionCategory').innerText = decodeURIComponent(questionCategory);
        document.getElementById('questionPoints').innerText = questionPoints;

        let voteRegistered = false;

        // Realtime update for team names
        db.collection('games').doc(gameId).onSnapshot((doc) => {
            if (doc.exists) {
                const gameData = doc.data();
                document.getElementById('teamOneName').innerText = gameData.teamOneName || 'Team One';
                document.getElementById('teamTwoName').innerText = gameData.teamTwoName || 'Team Two';
            }
        });

        function vote(team) {
            if (!voteRegistered) {
                db.collection('games').doc(gameId).collection('votes').doc(team).update({
                    count: firebase.firestore.FieldValue.increment(1),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                }).then(() => {
                    voteRegistered = true;
                    alert(`${team} voted successfully!`);
                }).catch((error) => {
                    console.error("Error voting: ", error);
                });
            } else {
                alert("You've already voted!");
            }
        }

        // Realtime update for voting results
        db.collection('games').doc(gameId).collection('votes').onSnapshot((snapshot) => {
            snapshot.docChanges().forEach((change) => {
                if (change.type === "modified" || change.type === "added") {
                    const team = change.doc.id;
                    const voteData = change.doc.data();
                    if (team === "TeamOne") {
                        document.getElementById('teamOne').style.backgroundColor = voteData.timestamp ? '#4CAF50' : '#d32f2f';
                    } else if (team === "TeamTwo") {
                        document.getElementById('teamTwo').style.backgroundColor = voteData.timestamp ? '#4CAF50' : '#1976d2';
                    }
                }
            });
        });
    </script>
</body>
</html>
